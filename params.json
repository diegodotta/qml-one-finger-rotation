{"name":"One Finger Rotation","tagline":"JS+QML - Rotate a object with one finger","body":"I got a AS2 project and converted to JS/QML, the visual result was great, but the code is horrible, is the worst code of my life, i hope that this experiment can useful for someone to create a smarter mousearea.\r\n\r\ngood luck\r\n\r\n[youtube=http://www.youtube.com/watch?v=llM9yBAH6vM]\r\n<h3>This is a experiement, bad experiment!</h3>\r\n\r\n[sourcecode language=\"javascript\"]\r\n\r\nimport QtQuick 1.0\r\n\r\nRectangle{\r\n    id: root\r\n    width: 720\r\n    height: 480\r\n    color: \"#000\"\r\n\r\n    property real m: 1;\r\n    property real modo\r\n    property real modo_time\r\n    property real inercia: 700; //600\r\n    property real inx: rect.x;\r\n    property real iny: rect.y;\r\n    property real r: rect.rotation;\r\n    //friccion\r\n    property real b: 1.2;\r\n    //inicializando\r\n    property real vr: 0\r\n    property real torque: 0\r\n    property real vx: 0\r\n    property real vy: 0\r\n    property real  mxx: 0\r\n    property real  my: 0\r\n    property real  mx0: 0\r\n    property real  my0: 0\r\n    property real  dmx: 0\r\n    property real  dmy: 0\r\n    property real  fx: 0\r\n    property real  fy: 0\r\n    property real  ldx: 0\r\n    property real  ldy: 0\r\n    property real  mlength: 0\r\n    property real  mforce: 0\r\n    property real  addx: 0\r\n    property real  addy: 0\r\n    property real  k: 0\r\n    property real  kx: 0\r\n    property real  ky: 0\r\n    property real newMouseX\r\n    property real newMouseY\r\n\r\n    Rectangle{\r\n        id: rect\r\n\r\n        property real qAngle\r\n        x: parent.width/2\r\n        y: parent.height/2\r\n        width: 250\r\n        height: 250\r\n        smooth: true\r\n\r\n        transform: Translate { y: -rect.height/2; x: -rect.width/2 }\r\n\r\n        MouseArea{\r\n            anchors.fill: rect\r\n            onPressed: {\r\n                modo = 1;\r\n                modo_time = 1;\r\n                timer.start()\r\n            }\r\n            onReleased:{\r\n                modo = 2;\r\n                modo_time = 1;\r\n            }\r\n            onMousePositionChanged: {\r\n                var coisa = mapToItem(root,mouseX,mouseY)\r\n                newMouseX = coisa.x\r\n                newMouseY = coisa.y\r\n            }\r\n        }\r\n    }\r\n\r\n    Timer{\r\n        id: timer\r\n        interval: 30\r\n        repeat: true\r\n        onTriggered: {\r\n            if (modo == 1) {\r\n                if (modo_time == 1) {\r\n                    modo_time = 0;\r\n                    mxx = newMouseX;\r\n                    my = newMouseY;\r\n                    mx0 = mxx;\r\n                    my0 = my;\r\n                    dmx = mxx-mx0;\r\n                    dmy = my-my0;\r\n                } else {\r\n                    mxx = (newMouseX+mxx)/2;\r\n                    my = (newMouseY+my)/2;\r\n                    dmx = mxx-mx0;\r\n                    dmy = my-my0;\r\n                    mx0 = mxx;\r\n                    my0 = my;\r\n                }\r\n                fx = (dmx-vx)*m;\r\n                fy = (dmy-vy)*m;\r\n                ldx = mxx-inx;\r\n                ldy = my-iny;\r\n                if (fx == 0) {\r\n                    mlength = ldx;\r\n                    mforce = fy;\r\n                    torque = mforce*mlength;\r\n                } else if (fy == 0) {\r\n                    mlength = ldy;\r\n                    mforce = fx;\r\n                    torque = -(mforce)*mlength;\r\n                } else {\r\n                    k = fy/fx;\r\n                    kx = (-(k)*k*ldx+k*ldy)/(-(k)*k-1);\r\n                    ky = k*(kx-ldx)+ldy;\r\n                    mlength = Math.sqrt(kx*kx+ky*ky);\r\n                    mforce = Math.sqrt(fx*fx+fy*fy);\r\n                    if (fx*ky>0) {\r\n                        torque = -(mforce)*mlength;\r\n                    } else {\r\n                        torque = mforce*mlength;\r\n                    }\r\n                }\r\n                vx = dmx;\r\n                vy = dmy;\r\n                inx += vx;\r\n                iny += vy;\r\n                vr = vr-torque/inercia;\r\n                ldx = mxx-inx;\r\n                ldy = my-iny;\r\n                var cos;\r\n                var sin;\r\n                cos = Math.cos(vr/180*Math.PI);\r\n                sin = Math.sin(vr/180*Math.PI);\r\n                addx = ldx*cos+ldy*sin-ldx;\r\n                addy = -(ldx)*sin+ldy*cos-ldy;\r\n                inx += -(addx);\r\n                iny += -(addy);\r\n            } else if (modo == 2) {\r\n                if (modo_time == 1) {\r\n                    modo_time = 0;\r\n                    vx = vx-(addx);\r\n                    vy = vy-(addy);\r\n                }\r\n                torque = 0;\r\n                addx = 0;\r\n                addy = 0;\r\n                inx += vx;\r\n                iny += vy;\r\n                if(Math.round(vx) == 0 && Math.round(vy) == 0){\r\n                    timer.stop()\r\n                }\r\n            }\r\n            r -= vr;\r\n            rect.x = inx;\r\n            rect.y = iny;\r\n            rect.rotation = r;\r\n            vx = vx/b;\r\n            vy = vy/b;\r\n            vr = vr/b;\r\n        }\r\n    }\r\n}\r\n[/sourcecode]\r\n\r\nOkay, now you can throw!\r\n<h3>GITHUB Project</h3>\r\n<a href=\"https://github.com/diegodotta/one-finger-rotation\" target=\"_blank\">https://github.com/diegodotta/one-finger-rotation</a>````````","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}